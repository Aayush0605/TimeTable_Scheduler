<!DOCTYPE html>
<html>
<head>
    <title>Timetable - Smart Classroom Scheduler</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/' + theme + '_theme.css') }}">
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">Smart Classroom Scheduler</a>
            <div class="navbar-nav">
                <a class="nav-link" href="/dashboard">Back to Dashboard</a>
                <a class="nav-link" href="/timetable/export/csv">Export CSV</a>
                <a class="nav-link" href="/timetable/export/excel">Export Excel</a>
                <a class="nav-link" href="/timetable/export/pdf">Export PDF</a>
                <a class="nav-link" href="/timetable/export/ics">Export ICS</a>
                <select onchange="window.location.href='/set_theme/' + this.value" class="form-select">
                    <option value="tech" {% if theme == 'tech' %}selected{% endif %}>Tech Theme</option>
                    <option value="normal" {% if theme == 'normal' %}selected{% endif %}>Normal Theme</option>
                </select>
                <a class="nav-link" href="/logout">Logout</a>
            </div>
        </div>
    </nav>
    <div class="container mt-4">
        <h2>{{ "My Timetable" if role in ['student', 'teacher'] else "Department Timetable" }}</h2>
        <button class="btn btn-primary mb-3" onclick="showCalendar()">Show Calendar View</button>
        {% if theme == 'tech' %}
            <pre class="timetable-pre">
| {{ 'Day'.ljust(10) }} | {{ 'Time Slot'.ljust(15) }} | {{ 'Course'.ljust(20) }} | {{ 'Teacher'.ljust(15) }} | {{ 'Room'.ljust(10) }} | {{ 'Class'.ljust(10) }} |
|------------|----------------|---------------------|----------------|------------|------------|
{% for slot in timetable %}
| {{ slot.day.ljust(10) }} | {{ slot.time.ljust(15) }} | {{ (slot.course.name if slot.course else 'Free/Break').ljust(20) }} | {{ (slot.teacher.name if slot.teacher else '-').ljust(15) }} | {{ (slot.room.name if slot.room else '-').ljust(10) }} | {{ (slot.class_id or '-').ljust(10) }} |{% if slot.conflicts > 0 %} (Conflict){% endif %}
{% endfor %}
            </pre>
        {% else %}
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Day</th>
                        <th>Time</th>
                        <th>Course</th>
                        <th>Teacher</th>
                        <th>Room</th>
                        <th>Class</th>
                    </tr>
                </thead>
                <tbody>
                    {% for slot in timetable %}
                        <tr class="{{ 'conflict' if slot.conflicts > 0 }}">
                            <td>{{ slot.day }}</td>
                            <td>{{ slot.time }}</td>
                            <td>{{ slot.course.name if slot.course else 'Free/Break' }}</td>
                            <td>{{ slot.teacher.name if slot.teacher else '-' }}</td>
                            <td>{{ slot.room.name if slot.room else '-' }}</td>
                            <td>{{ slot.class_id or '-' }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
        <div id="calendar" style="display: none;"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>
    <script>
        function showCalendar() {
            document.querySelector('.timetable-pre, .table').style.display = 'none';
            document.getElementById('calendar').style.display = 'block';
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'timeGridWeek',
                slotMinTime: '09:00:00',
                slotMaxTime: '17:00:00',
                events: [
                    {% for slot in timetable %}
                        {
                            title: '{{ slot.course.name if slot.course else "Free/Break" }} ({{ slot.class_id or "-" }})',
                            start: '2025-09-{{ "01" if slot.day == "Monday" else "02" }}T{{ slot.time.split("-")[0] }}:00',
                            end: '2025-09-{{ "01" if slot.day == "Monday" else "02" }}T{{ slot.time.split("-")[1] }}:00',
                            extendedProps: { room: '{{ slot.room.name if slot.room else "-" }}' }
                        },
                    {% endfor %}
                ]
            });
            calendar.render();
        }
    </script>
</body>
</html>